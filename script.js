const trainingBank = {
    'قلبية': [
        { level: 'easy', case: 'مريض 60 عاماً، يعاني من ألم صدري ضاغط خلف القص ينتشر للذراع اليسرى.', tools: { takhṭīṭ_qalb: 'ارتفاع وصلة ST في المساري السفلية.' }, choices: ['احتشاء عضلة قلبية سفلي', 'التهاب التامور', 'تسلخ الأبهر', 'قرحة هضمية'], answer: 'احتشاء عضلة قلبية سفلي' },
        { level: 'medium', case: 'مريضة 70 عاماً، لديها قصة قصور قلب، أتت بزلة تنفسية شديدة وسعال رغوي زهري.', tools: { tasammu: 'خراخر ناعمة منتشرة في الساحتين الرئويتين.', taammul: 'وذمات انطباعية في الطرفين السفليين.' }, choices: ['وذمة رئة حادة قلبية المنشأ', 'نوبة ربو حادة', 'ذات رئة', 'صمة رئوية'], answer: 'وذمة رئة حادة قلبية المنشأ' },
        { level: 'hard', case: 'رجل 65 عاماً، أتى بألم صدري حاد "كالتمزيق" ينتشر إلى الظهر بين لوحي الكتف.', tools: { taammul: 'الضغط الشرياني في الذراع اليمنى (180/100) أعلى بكثير من اليسرى (110/70).', jass: 'غياب النبض في أحد الشرايين المحيطية.', takhṭīṭ_qalb: 'قد يظهر ارتفاع ST إذا امتد التسلخ للشرايين الإكليلية.' }, choices: ['تسلخ الأبهر', 'احتشاء عضلة قلبية', 'صمة رئوية', 'التهاب التامور'], answer: 'تسلخ الأبهر' }
    ],
    'غدية': [
        { level: 'easy', case: 'شابة تشكو من زيادة في الوزن، عدم تحمل البرد، وإمساك.', tools: { tahmeel: 'ارتفاع TSH وانخفاض T4.' }, choices: ['قصور درق أولي', 'فرط درق', 'داء كوشينغ', 'داء أديسون'], answer: 'قصور درق أولي' },
        { level: 'medium', case: 'مريض سكري النوع الأول أتى إلى الإسعاف بحالة تغيم وعي ورائحة أسيتون في نفسه.', tools: { tahmeel: 'ارتفاع سكر الدم، حماض استقلابي، ووجود كيتونات في البول والدم.', taammul: 'تنفس كوسماول (سريع وعميق).' }, choices: ['حماض كيتوني سكري (DKA)', 'سبات فرط حلولية', 'نقص سكر الدم', 'حماض لاكتيكي'], answer: 'حماض كيتوني سكري (DKA)' },
        { level: 'hard', case: 'مريض يشكو من نوب من الصداع، التعرق، والخفقان، مع ارتفاع شديد في الضغط الشرياني خلال هذه النوب.', tools: { tahmeel: 'ارتفاع الميتانفرينات في بلازما الدم وبول 24 ساعة.', jass: 'قد تتحرض النوب بالضغط على البطن.', takhṭīṭ_qalb: 'تسرع قلب جيبي أثناء النوبة.' }, choices: ['ورم القواتم (Pheochromocytoma)', 'فرط الدرق', 'قلق وهلع', 'ارتفاع ضغط أساسي'], answer: 'ورم القواتم (Pheochromocytoma)' }
    ],
    'عصبية': [
        { level: 'easy', case: 'شاب أتى بشلل وجهي مفاجئ في نصف الوجه، مع عدم القدرة على إغماض العين أو رفع الحاجب في نفس الجهة.', tools: { munakkisat: 'قوة العضلات في الأطراف طبيعية.' }, choices: ['شلل بيل (شلل العصب الوجهي المحيطي)', 'جلطة دماغية', 'ورم في الدماغ', 'تصلب لويحي'], answer: 'شلل بيل (شلل العصب الوجهي المحيطي)' },
        { level: 'medium', case: 'رجل 70 عاماً، يشكو من رجفان في اليدين وقت الراحة، بطء في الحركة، وصلابة في العضلات.', tools: { taammul: 'مشية بخطوات قصيرة مع انحناء الجذع للأمام (مشية عابثة). وجه قناعي قليل التعابير.', munakkisat: 'صلابة "العجلة المسننة" عند تحريك الأطراف بشكل منفعل.' }, choices: ['داء باركنسون', 'رجفان أساسي', 'شلل فوق النوى المترقي', 'ضمور أجهزة متعدد'], answer: 'داء باركنسون' },
        { level: 'hard', case: 'مريض أتى بصداع شديد مفاجئ هو "الأسوأ في حياته"، مع صلابة في النقرة وغثيان.', tools: { munakkisat: 'علامات السحايا (كيرنيغ وبرودزينسكي) إيجابية.', taammul: 'رهاب الضوء وتخليط ذهني.', jass: 'لا يوجد إيلام في الجيوب الأنفية.' }, choices: ['نزف تحت عنكبوتي (SAH)', 'التهاب سحايا جرثومي', 'صداع نصفي', 'ورم دماغي'], answer: 'نزف تحت عنكبوتي (SAH)' }
    ],
    'هضمية': [
        { level: 'easy', case: 'شاب يعاني من ألم شرسوفي يزداد بالطعام الحامض ويخف بمضادات الحموضة.', tools: { jass: 'إيلام خفيف في الشرسوف عند الجس العميق.' }, choices: ['قرحة هضمية', 'التهاب بنكرياس', 'حصيات مرارية', 'قلس معدي مريئي'], answer: 'قرحة هضمية' },
        { level: 'medium', case: 'مريض كحولي أتى بألم بطني شديد في الشرسوف ينتشر بشكل "حزامي" إلى الظهر.', tools: { tahmeel: 'ارتفاع شديد في الأميلاز والليبار المصلي.', jass: 'إيلام شديد في الشرسوف مع غياب الأصوات المعوية.' }, choices: ['التهاب بنكرياس حاد', 'انثقاب قرحة', 'احتشاء مساريقي', 'مغص مراري'], answer: 'التهاب بنكرياس حاد' },
        { level: 'hard', case: 'مريض 60 عاماً، لديه قصة تشمع كبد، أتى بقيء دموي غزير أحمر قانئ.', tools: { taammul: 'يرقان، حبن، وعلامات تشمع أخرى (عناكب وعائية).', tahmeel: 'هبوط هيموغلوبين حاد ونقص صفيحات.', jass: 'تضخم في الطحال.' }, choices: ['نزف دوالي المريء', 'قرحة نازفة', 'متلازمة مالوري فايس', 'سرطان المعدة'], answer: 'نزف دوالي المريء' }
    ],
    'بولية': [
        { level: 'easy', case: 'شابة تشكو من حرقة وتبوال متكرر وإلحاح بولي.', tools: { tahmeel: 'وجود كريات بيض ونتريت إيجابي في تحليل البول.' }, choices: ['التهاب مثانة حاد (عدوى بولية سفلية)', 'التهاب حويضة وكلية', 'حصاة حالب', 'التهاب مهبل'], answer: 'التهاب مثانة حاد (عدوى بولية سفلية)' },
        { level: 'medium', case: 'رجل يعاني من ألم شديد مفاجئ في الخاصرة ينتشر إلى منطقة العانة، مع غثيان وبيلة دموية.', tools: { taammul: 'المريض لا يستطيع أن يهدأ في مكانه من شدة الألم.', tahmeel: 'وجود كريات دم حمراء بكثرة في تحليل البول.' }, choices: ['مغص كلوي (حصاة حالب)', 'التهاب حويضة وكلية', 'التهاب زائدة دودية', 'أمه دم أبهرية بطنية'], answer: 'مغص كلوي (حصاة حالب)' },
        { level: 'hard', case: 'رجل كبير في السن، لديه قصة ضخامة بروستات، أتى بعدم قدرة تامة على التبول منذ 12 ساعة مع ألم شديد فوق العانة.', tools: { jass: 'جس كرة مؤلمة فوق العانة (مثانة ممتلئة).', qar: 'أصمية عند قرع منطقة فوق العانة.', munakkisat: 'فحص المس الشرجي يظهر تضخم البروستات.' }, choices: ['احتباس بولي حاد', 'قصور كلوي حاد', 'التهاب بروستات حاد', 'حصاة مثانة'], answer: 'احتباس بولي حاد' }
    ],
    'دموية': [
        { level: 'easy', case: 'شابة تشكو من تعب، خفقان، وشحوب. نظامها الغذائي نباتي.', tools: { tahmeel: 'فقر دم صغير الكريات ناقص الصباغ، مع انخفاض فيرّيتين المصل.' }, choices: ['فقر دم بعوز الحديد', 'فقر دم بعوز فيتامين B12', 'ثلاسيميا', 'فقر دم الأمراض المزمنة'], answer: 'فقر دم بعوز الحديد' },
        { level: 'medium', case: 'طفل أتى بنزوف من الأنف واللثة وكدمات متعددة على جسمه بعد أسبوع من إصابة فيروسية.', tools: { tahmeel: 'نقص شديد في عدد الصفيحات الدموية مع سلامة بقية عناصر الدم.', taammul: 'وجود فرفريات رطبة في الفم.' }, choices: ['فرفرية قليلة الصفيحات مجهولة السبب (ITP)', 'لوكيميا حادة', 'ناعور', 'داء فون فيليبراند'], answer: 'فرفرية قليلة الصفيحات مجهولة السبب (ITP)' },
        { level: 'hard', case: 'شاب من أصل أفريقي، لديه قصة فقر دم مزمن، أتى بألم شديد في العظام والصدر والبطن.', tools: { tahmeel: 'لطاخة الدم المحيطية تظهر كريات دم حمراء بشكل "منجلي".', taammul: 'شحوب ويرقان خفيف.', tasammu: 'قد تكون أصوات التنفس طبيعية أو تظهر علامات متلازمة الصدر الحادة.' }, choices: ['نوبة مؤلمة في سياق فقر الدم المنجلي', 'احتشاء عظمي', 'متلازمة الصدر الحادة', 'التهاب العظم والنقي'], answer: 'نوبة مؤلمة في سياق فقر الدم المنجلي' }
    ],
    'صدرية': [
        { level: 'easy', case: 'شاب يعاني من سعال و صفير في الصدر يزداد ليلاً وبعد ممارسة الرياضة.', tools: { tasammu: 'وزيز منتشر في الساحتين الرئويتين.' }, choices: ['ربو قصبي', 'التهاب قصبات حاد', 'ذات رئة', 'توسع قصبات'], answer: 'ربو قصبي' },
        { level: 'medium', case: 'مدخن مزمن، يعاني من سعال منتج للقشع معظم أيام السنة، مع زلة تنفسية تزداد تدريجياً.', tools: { tasammu: 'أصوات تنفسية منخفضة و وزيز.', taammul: 'صدر برميلي الشكل.' }, choices: ['داء الانسداد الرئوي المزمن (COPD)', 'ربو', 'تليف رئوي', 'سرطان رئة'], answer: 'داء الانسداد الرئوي المزمن (COPD)' },
        { level: 'hard', case: 'شاب طويل ونحيل، أتى بألم صدري حاد ومفاجئ مع زلة تنفسية شديدة.', tools: { tasammu: 'غياب الأصوات التنفسية في جهة واحدة من الصدر.', qar: 'فرط رنين عند القرع في نفس الجهة.', taammul: 'انحراف الرغامى للجهة السليمة (في حال الريح الصدرية الضاغطة).' }, choices: ['ريح صدرية عفوية أولية', 'صمة رئوية', 'احتشاء عضلة قلبية', 'ذات رئة'], answer: 'ريح صدرية عفوية أولية' }
    ],
    'رثوية': [
        { level: 'easy', case: 'امرأة مسنة تشكو من ألم في الركبة يزداد بالحركة ويخف بالراحة.', tools: { jass: 'فرقعة مفصلية (crepitus) عند الحركة.' }, choices: ['فصال عظمي (خشونة المفصل)', 'التهاب المفاصل الرثياني', 'داء النقرس', 'التهاب مفصل إنتاني'], answer: 'فصال عظمي (خشونة المفصل)' },
        { level: 'medium', case: 'رجل 50 عاماً، استيقظ صباحاً على ألم شديد واحمرار وتورم في مفصل إبهام القدم.', tools: { tahmeel: 'ارتفاع حمض البول في المصل.', taammul: 'المفصل أحمر، متورم، ولامع.' }, choices: ['داء النقرس الحاد', 'التهاب مفصل إنتاني', 'التهاب مفصل رثياني', 'رض'], answer: 'داء النقرس الحاد' },
        { level: 'hard', case: 'شابة 22 عاماً، تشكو من حمى، ألم مفاصل، وطفح جلدي على الوجه يأخذ شكل "الفراشة" بعد التعرض للشمس.', tools: { tahmeel: 'إيجابية أضداد النواة (ANA) و Anti-dsDNA.', taammul: 'وجود تقرحات فموية غير مؤلمة.', munakkisat: 'طبيعية.' }, choices: ['ذئبة حمامية جهازية (SLE)', 'التهاب جلد وعضل', 'وردية الوجه', 'حساسية ضوئية دوائية'], answer: 'ذئبة حمامية جهازية (SLE)' }
    ]
};


const challengeBank = {
    // -- الحالات الأساسية (أول 15 حالة تظهر في أول محاولة) --
    core: {
        easy: [
            {
                id: 'CORE-E-1', level: 'easy', case: 'شاب يعاني من ألم بطني حول السرة ثم انتقل إلى الحفرة الحرقفية اليمنى، مع فقدان شهية وحمى خفيفة.',
                tools: { jass: 'إيلام واضح في نقطة ماكبرني مع دفاع عضلي.' },
                choices: ['التهاب زائدة دودية حاد', 'التهاب رتوج', 'حصاة حالب أيمن', 'كيسة مبيضية ملتوية'], answer: 'التهاب زائدة دودية حاد'
            },
            {
                id: 'CORE-E-2', level: 'easy', case: 'امرأة 30 عاماً، تشكو من خفقان، تعرق، رجفان في اليدين، عدم تحمل الحرارة، وفقدان وزن رغم زيادة شهيتها.',
                tools: { taammul: 'جحوظ خفيف في العينين (exophthalmos) وتضخم متناظر في الغدة الدرقية.' },
                choices: ['داء غريفز (فرط درق)', 'ورم القواتم', 'نوبات هلع', 'قصور درق'], answer: 'داء غريفز (فرط درق)'
            },
            {
                id: 'CORE-E-3', level: 'easy', case: 'طفل 7 سنوات، يعاني من التهاب حلق، وبعد 10 أيام ظهر لديه تورم في الوجه وبول بلون "الكوكا كولا".',
                tools: { tahmeel: 'تحليل البول يظهر وجود دم وبروتين، مع أسطوانات الكريات الحمر.' },
                choices: ['التهاب كبب وكلية تالٍ للعقديات', 'المتلازمة الكلوية', 'التهاب حويضة وكلية', 'حصاة كلوية'], answer: 'التهاب كبب وكلية تالٍ للعقديات'
            },
            {
                id: 'CORE-E-4', level: 'easy', case: 'رجل 60 عاماً، أتى بألم شديد وتورم واحمرار في مفصل إبهام القدم، بدأ بشكل حاد في منتصف الليل.',
                tools: { taammul: 'المفصل المصاب شديد الحساسية للمس، لامع، وأحمر اللون.' },
                choices: ['داء النقرس الحاد', 'التهاب مفصل إنتاني', 'التهاب الهلل (Cellulitis)', 'كسر إجهادي'], answer: 'داء النقرس الحاد'
            },
            {
                id: 'CORE-E-5', level: 'easy', case: 'شابة تشكو من تعب، وشحوب، وتشققات في زوايا الفم (التهاب الشفة الزاوي). تتبع نظاماً غذائياً نباتياً.',
                tools: { tahmeel: 'فقر دم صغير الكريات ناقص الصباغ، مع انخفاض فيرّيتين المصل.' },
                choices: ['فقر دم بعوز الحديد', 'فقر دم بعوز فيتامين B12', 'ثلاسيميا', 'فقر دم الأمراض المزمنة'], answer: 'فقر دم بعوز الحديد'
            }
        ],
        medium: [
            {
                id: 'CORE-M-1', level: 'medium', case: 'مريض 50 عاماً، لديه قصة ارتفاع شحوم، أتى بألم شرسوفي حاد وشديد ينتشر بشكل "حزامي" إلى الظهر، مع غثيان وقيء.',
                tools: {
                    jass: 'إيلام شديد في الشرسوف، مع غياب الأصوات المعوية.',
                    tahmeel: 'ارتفاع كبير جداً في إنزيم الليباز (أكثر من 3 أضعاف الطبيعي).'
                },
                choices: ['التهاب بنكرياس حاد', 'احتشاء عضلة قلبية سفلي', 'انثقاب قرحة هضمية', 'مغص مراري'], answer: 'التهاب بنكرياس حاد'
            },
            {
                id: 'CORE-M-2', level: 'medium', case: 'مريض 70 عاماً، لديه قصة خثار وريدي عميق (DVT) سابق، أتى بزلة تنفسية حادة ومفاجئة وألم صدري طاعن يزداد مع التنفس.',
                tools: {
                    taammul: 'تسرع في التنفس ونقص في الأكسجة.',
                    takhṭīṭ_qalb: 'تسرع قلب جيبي مع ظهور علامة S1Q3T3 الكلاسيكية.'
                },
                choices: ['صمة رئوية (PE)', 'احتشاء عضلة قلبية', 'ريح صدرية', 'ذات رئة'], answer: 'صمة رئوية (PE)'
            },
            {
                id: 'CORE-M-3', level: 'medium', case: 'شابة 28 عاماً، تشكو من نوب متكررة من الخدر والتنميل، ضعف في ساق واحدة، وتشوش في الرؤية (التهاب عصب بصري) استمر لأيام ثم تحسن.',
                tools: {
                    munakkisat: 'اشتداد المنعكسات الوترية العميقة مع وجود علامة بابنسكي إيجابية.',
                    taammul: 'فحص قعر العين يظهر شحوباً في القرص البصري (دليل على نوبة سابقة).'
                },
                choices: ['تصلب لويحي (MS)', 'ذئبة حمامية جهازية', 'نقص فيتامين B12', 'متلازمة غيلان باريه'], answer: 'تصلب لويحي (MS)'
            },
            {
                id: 'CORE-M-4', level: 'medium', case: 'مريض سكري النوع الأول، 19 عاماً، أُحضر إلى الإسعاف بحالة تغيم وعي، تنفس سريع وعميق (تنفس كوسماول)، ورائحة أسيتون (فاكهة متعفنة) في نفسه.',
                tools: {
                    tahmeel: 'سكر دم مرتفع جداً (450 mg/dL)، ووجود كيتونات في البول والدم.',
                    taammul: 'علامات جفاف واضحة (جفاف أغشية مخاطية، ضعف مرونة الجلد).'
                },
                choices: ['حماض كيتوني سكري (DKA)', 'سبات فرط حلولية', 'نقص سكر الدم', 'حماض لاكتيكي'], answer: 'حماض كيتوني سكري (DKA)'
            },
            {
                id: 'CORE-M-5', level: 'medium', case: 'امرأة 45 عاماً، تشكو من ألم وتيبس صباحي في مفاصل اليدين الصغيرة (المفاصل السنعية السلامية والبروكسيمالية بين السلامية) مع تورم بشكل متناظر.',
                tools: {
                    taammul: 'تورم بشكل "مغزلي" في المفاصل بين السلامية القريبة وانحراف زندي في الأصابع.',
                    tahmeel: 'العامل الرثياني (RF) و Anti-CCP إيجابيان.'
                },
                choices: ['التهاب المفاصل الرثياني (RA)', 'فصال عظمي', 'ذئبة حمامية جهازية', 'التهاب مفاصل صدافي'], answer: 'التهاب المفاصل الرثياني (RA)'
            }
        ],
        hard: [
            {
                id: 'CORE-H-1', level: 'hard', case: 'مريض 70 عاماً، أتى بصداع شديد مفاجئ وصفه بأنه "أسوأ صداع في حياته"، مع غثيان وقيء ثم فقد وعيه لفترة وجيزة.',
                tools: {
                    taammul: 'المريض في حالة تخليط ذهني، مع وجود صلابة في النقرة.',
                    munakkisat: 'علامة كيرنيغ وبرودزينسكي إيجابية (علامات تهيج السحايا).',
                    takhṭīṭ_qalb: 'طبيعي.'
                },
                choices: ['نزف تحت عنكبوتي (SAH)', 'التهاب سحايا جرثومي', 'صداع نصفي شديد', 'ورم دماغي نازف'], answer: 'نزف تحت عنكبوتي (SAH)'
            },
            {
                id: 'CORE-H-2', level: 'hard', case: 'مريض 30 عاماً، أتى بضعف عضلي مترقٍ صاعد بدأ في القدمين وامتد للأعلى خلال يومين، مع غياب المنعكسات. لديه قصة إسهال (عدوى كامبيلوباكتر) قبل أسبوعين.',
                tools: {
                    munakkisat: 'غياب تام للمنعكسات الوترية العميقة في الطرفين السفليين (منعكس الرضفة وأخيل).',
                    jass: 'لا يوجد مستوى حسي محدد، لكن المريض يشكو من تنميل في الأطراف.',
                    taammul: 'قوة العضلات 2/5 في الطرفين السفليين و 4/5 في الطرفين العلويين.'
                },
                choices: ['متلازمة غيلان باريه (GBS)', 'تصلب لويحي', 'وهن عضلي وبيل', 'تسمم وشيقي (Botulism)'], answer: 'متلازمة غيلان باريه (GBS)'
            },
            {
                id: 'CORE-H-3', level: 'hard', case: 'مريض 40 عاماً، يشكو من نوب من الصداع الشديد، التعرق الغزير، والخفقان، تترافق مع ارتفاع حاد ومفاجئ في الضغط الشرياني (يصل إلى 220/120).',
                tools: {
                    tahmeel: 'ارتفاع الميتانفرينات في بلازما الدم وبول 24 ساعة.',
                    takhṭīṭ_qalb: 'يظهر تسرع قلب جيبي أثناء النوبة.',
                    taammul: 'شحوب أثناء النوبة يليه احمرار.'
                },
                choices: ['ورم القواتم (Pheochromocytoma)', 'فرط الدرق الحاد (عاصفة درقية)', 'قلق وهلع شديد', 'ارتفاع ضغط خبيث'], answer: 'ورم القواتم (Pheochromocytoma)'
            },
            {
                id: 'CORE-H-4', level: 'hard', case: 'مريض 65 عاماً، لديه قصة رجفان أذيني ويتناول مميعات الدم بشكل غير منتظم، أتى بألم بطني شديد ومفاجئ "غير متناسب" مع الموجودات القليلة بالفحص السريري.',
                tools: {
                    jass: 'البطن لين بشكل مفاجئ، مع إيلام خفيف منتشر فقط.',
                    tasammu: 'غياب الأصوات المعوية.',
                    tahmeel: 'حماض استقلابي شديد مع ارتفاع اللاكتات في الدم بشكل كبير.'
                },
                choices: ['احتشاء مساريقي حاد', 'التهاب بنكرياس حاد', 'انثقاب أحشاء', 'انسداد أمعاء'], answer: 'احتشاء مساريقي حاد'
            },
            {
                id: 'CORE-H-5', level: 'hard', case: 'شابة 24 عاماً، تشكو من حمى، ألم مفاصل، وطفح جلدي على الوجه يأخذ شكل "الفراشة" على الخدين وجسر الأنف ويزداد بعد التعرض للشمس.',
                tools: {
                    taammul: 'وجود تقرحات فموية غير مؤلمة، مع الطفح الفراشي المميز.',
                    tahmeel: 'إيجابية أضداد النواة (ANA) وأضداد Anti-dsDNA.',
                    munakkisat: 'طبيعية.'
                },
                choices: ['ذئبة حمامية جهازية (SLE)', 'التهاب جلد وعضل', 'وردية الوجه (Rosacea)', 'حساسية ضوئية دوائية'], answer: 'ذئبة حمامية جهازية (SLE)'
            }
        ]
    },
    // ... (الجزء التالي يحتوي على البنك الاحتياطي)
    // -- البنك الاحتياطي (يتم السحب منه عشوائياً في المحاولات التالية) --
reserve: {
    easy: [
        { id: 'RES-E-1', level: 'easy', case: 'مريض أتى بألم وحرقة خلف القص يزداد بالانحناء ليلاً.', tools: { tasammu: 'طبيعي.' }, choices: ['القلس المعدي المريئي (GERD)', 'احتشاء عضلة قلبية', 'تشنج مريء', 'قرحة هضمية'], answer: 'القلس المعدي المريئي (GERD)' },
        { id: 'RES-E-2', level: 'easy', case: 'شاب يعاني من عطاس، سيلان أنف مائي، وحكة في العينين كل فصل ربيع.', tools: { taammul: 'احتقان وشحوب في مخاطية الأنف.' }, choices: ['التهاب أنف تحسسي (حمى القش)', 'زكام (رشح شائع)', 'التهاب جيوب', 'كوفيد-19'], answer: 'التهاب أنف تحسسي (حمى القش)' },
        { id: 'RES-E-3', level: 'easy', case: 'مريض يشكو من ألم بطني معمم مع تبدل في عادات التغوط (إسهال يتناوب مع إمساك). الأعراض تزداد بالتوتر.', tools: { jass: 'لا يوجد إيلام موضعي، البطن منتفخ قليلاً.' }, choices: ['متلازمة القولون المتهيج (IBS)', 'داء كرون', 'التهاب قولون قرحي', 'سرطان قولون'], answer: 'متلازمة القولون المتهيج (IBS)' },
        { id: 'RES-E-4', level: 'easy', case: 'امرأة تشكو من تعب، زيادة في الوزن، شعر جاف ومتقصف، وعدم تحمل البرد.', tools: { tahmeel: 'TSH مرتفع، T4 منخفض.' }, choices: ['قصور درق', 'فرط درق', 'فقر دم', 'اكتئاب'], answer: 'قصور درق' },
        { id: 'RES-E-5', level: 'easy', case: 'طفل لديه حمى وطفح جلدي حاك على شكل بقع حمراء ثم حويصلات تنتشر في كل الجسم.', tools: { taammul: 'توجد آفات جلدية في مراحل مختلفة (بقع، حويصلات، بثور، جلبات) في نفس الوقت.' }, choices: ['جدري الماء (الحماق)', 'الحصبة', 'الحصبة الألمانية', 'مرض اليد والقدم والفم'], answer: 'جدري الماء (الحماق)' },
        { id: 'RES-E-6', level: 'easy', case: 'مريض أتى بألم حاد في الأذن بعد السباحة.', tools: { taammul: 'ألم شديد عند سحب صيوان الأذن للخارج، مع احمرار وتورم في قناة السمع الظاهرة.' }, choices: ['التهاب أذن خارجية (أذن السبّاح)', 'التهاب أذن وسطى', 'جسم غريب في الأذن', 'تجمع صملاخ'], answer: 'التهاب أذن خارجية (أذن السبّاح)' },
        { id: 'RES-E-7', level: 'easy', case: 'شابة تشكو من حرقة وتبوال متكرر وإلحاح بولي.', tools: { tahmeel: 'تحليل البول السريع (dipstick) يظهر وجود كريات بيض (Leukocyte esterase) ونتريت.' }, choices: ['التهاب مثانة حاد (عدوى بولية سفلية)', 'التهاب حويضة وكلية', 'حصاة حالب', 'التهاب مهبل'], answer: 'التهاب مثانة حاد (عدوى بولية سفلية)' },
        { id: 'RES-E-8', level: 'easy', case: 'رجل يعاني من ألم شديد مفاجئ في الخاصرة ينتشر إلى منطقة العانة، مع غثيان وبيلة دموية.', tools: { taammul: 'المريض لا يستطيع أن يهدأ في مكانه من شدة الألم (agitated).' }, choices: ['مغص كلوي (حصاة حالب)', 'التهاب حويضة وكلية', 'التهاب زائدة دودية', 'أمه دم أبهرية بطنية'], answer: 'مغص كلوي (حصاة حالب)' },
        { id: 'RES-E-9', level: 'easy', case: 'شاب يعاني من سعال و صفير في الصدر يزداد ليلاً وبعد ممارسة الرياضة.', tools: { tasammu: 'وزيز منتشر في الساحتين الرئويتين أثناء الزفير.' }, choices: ['ربو قصبي', 'التهاب قصبات حاد', 'ذات رئة', 'توسع قصبات'], answer: 'ربو قصبي' },
        { id: 'RES-E-10', level: 'easy', case: 'امرأة مسنة تشكو من ألم في الركبة يزداد بالحركة ويخف بالراحة.', tools: { jass: 'يُسمع صوت فرقعة (crepitus) عند تحريك المفصل.' }, choices: ['فصال عظمي (خشونة المفصل)', 'التهاب المفاصل الرثياني', 'داء النقرس', 'التهاب مفصل إنتاني'], answer: 'فصال عظمي (خشونة المفصل)' },
        { id: 'RES-E-11', level: 'easy', case: 'شاب أتى بشلل وجهي مفاجئ في نصف الوجه، مع عدم القدرة على إغماض العين أو رفع الحاجب في نفس الجهة.', tools: { munakkisat: 'قوة العضلات في الأطراف طبيعية، ولا يوجد اضطراب في الكلام.' }, choices: ['شلل بيل (شلل العصب الوجهي المحيطي)', 'جلطة دماغية', 'ورم في الدماغ', 'تصلب لويحي'], answer: 'شلل بيل (شلل العصب الوجهي المحيطي)' },
        { id: 'RES-E-12', level: 'easy', case: 'رجل 70 عاماً، يشكو من رجفان في اليدين وقت الراحة، بطء في الحركة، وصلابة في العضلات.', tools: { taammul: 'وجه قناعي قليل التعابير، مع مشية بخطوات قصيرة (shuffling gait).' }, choices: ['داء باركنسون', 'رجفان أساسي', 'شلل فوق النوى المترقي', 'ضمور أجهزة متعدد'], answer: 'داء باركنسون' },
        { id: 'RES-E-13', level: 'easy', case: 'شاب يعاني من ألم شرسوفي يزداد بالطعام الحامض ويخف بمضادات الحموضة.', tools: { jass: 'إيلام خفيف في الشرسوف عند الجس العميق.' }, choices: ['قرحة هضمية', 'التهاب بنكرياس', 'حصيات مرارية', 'قلس معدي مريئي'], answer: 'قرحة هضمية' },
        { id: 'RES-E-14', level: 'easy', case: 'طفل أتى بنزوف من الأنف واللثة وكدمات متعددة على جسمه بعد أسبوع من إصابة فيروسية.', tools: { tahmeel: 'نقص شديد في عدد الصفيحات الدموية مع سلامة بقية عناصر الدم.' }, choices: ['فرفرية قليلة الصفيحات مجهولة السبب (ITP)', 'لوكيميا حادة', 'ناعور', 'داء فون فيليبراند'], answer: 'فرفرية قليلة الصفيحات مجهولة السبب (ITP)' },
        { id: 'RES-E-15', level: 'easy', case: 'مدخن مزمن، يعاني من سعال منتج للقشع معظم أيام السنة، مع زلة تنفسية تزداد تدريجياً.', tools: { tasammu: 'أصوات تنفسية منخفضة و وزيز متفرق.' }, choices: ['داء الانسداد الرئوي المزمن (COPD)', 'ربو', 'تليف رئوي', 'سرطان رئة'], answer: 'داء الانسداد الرئوي المزمن (COPD)' },
        { id: 'RES-E-16', level: 'easy', case: 'مريض يعاني من إسهال مائي غزير بعد تناوله مضاداً حيوياً (كليندامايسين) الأسبوع الماضي.', tools: { tahmeel: 'إيجابي لذيفان المطثية العسيرة (C. difficile toxin) في البراز.' }, choices: ['التهاب قولون غشائي كاذب', 'إسهال مرتبط بالمضادات الحيوية', 'عدوى فيروسية', 'داء كرون'], answer: 'التهاب قولون غشائي كاذب' },
        { id: 'RES-E-17', level: 'easy', case: 'مريض أتى بألم شديد في الحلق، حمى، وصعوبة في البلع. الفحص يظهر وجود نتحات قيحية على اللوزتين.', tools: { taammul: 'تضخم في العقد اللمفاوية الرقبية الأمامية.' }, choices: ['التهاب لوزات جرثومي (عقدي)', 'التهاب لوزات فيروسي', 'كثرة الوحيدات العدوائية', 'خراجة حول اللوزة'], answer: 'التهاب لوزات جرثومي (عقدي)' },
        { id: 'RES-E-18', level: 'easy', case: 'شابة تشكو من ظهور مفاجئ لآفات جلدية حمراء مرتفعة وحاكة بشدة (شرى) تنتقل من مكان لآخر.', tools: { taammul: 'لويحات شروية مميزة بأحجام مختلفة على الجذع والأطراف.' }, choices: ['شرى حاد (Urticaria)', 'التهاب جلد تماسي', 'لدغ حشرات', 'طفح دوائي'], answer: 'شرى حاد (Urticaria)' },
        { id: 'RES-E-19', level: 'easy', case: 'رجل كبير في السن، لديه قصة ضخامة بروستات، أتى بعدم قدرة تامة على التبول منذ 12 ساعة مع ألم شديد فوق العانة.', tools: { jass: 'جس كرة مؤلمة ومملوءة فوق العانة (مثانة ممتلئة).' }, choices: ['احتباس بولي حاد', 'قصور كلوي حاد', 'التهاب بروستات حاد', 'حصاة مثانة'], answer: 'احتباس بولي حاد' },
        { id: 'RES-E-20', level: 'easy', case: 'مريض يعاني من ألم حارق ينتشر على مسار عصب جلدي في جهة واحدة من الصدر، يليه ظهور طفح حويصلي في نفس المنطقة.', tools: { taammul: 'حويصلات مجمعة على قاعدة حمامية تتبع مسار قطاع جلدي واحد ولا تتجاوز الخط الناصف.' }, choices: ['الحلأ النطاقي (Shingles)', 'التهاب جلد تماسي', 'لدغ حشرات', 'حلأ بسيط'], answer: 'الحلأ النطاقي (Shingles)' }
    ],
        medium: [
        {
            id: 'RES-M-1', level: 'medium', case: 'مريض مسن، غير متحرك بعد جراحة على مفصل الورك، أتى بتورم وألم واحمرار في ساق واحدة فقط.',
            tools: {
                taammul: 'الساق المصابة أشد حرارة وأكبر محيطاً من الأخرى عند قياسها.',
                jass: 'إيلام عند جس ربلة الساق (calf tenderness).'
            },
            choices: ['خثار وريدي عميق (DVT)', 'التهاب هيج (Cellulitis)', 'وذمة لمفية', 'تمزق عضلي (كيسة بيكر)'], answer: 'خثار وريدي عميق (DVT)'
        },
        {
            id: 'RES-M-2', level: 'medium', case: 'مريض كحولي مزمن، أتى بيرقان، حبن (تجمع سائل في البطن)، وتخليط ذهني.',
            tools: {
                taammul: 'توسع أوردة حول السرة (رأس ميدوزا)، وحمامى راحية (palmar erythema).',
                tahmeel: 'ارتفاع البيليروبين، نقص الألبومين، واضطراب في زمن البروثرومبين (INR).'
            },
            choices: ['تشمع كبد لا معاوض', 'التهاب كبد حاد', 'سرطان كبد منتشر', 'متلازمة بود-كياري'], answer: 'تشمع كبد لا معاوض'
        },
        {
            id: 'RES-M-3', level: 'medium', case: 'مريض سكري يعاني من حمى، قشعريرة، وألم في الخاصرة اليمنى.',
            tools: {
                tahmeel: 'بيلة قيحية (كريات بيض كثيرة في البول) مع أسطوانات الكريات البيض.',
                jass: 'إيلام شديد في الزاوية الضلعية الفقرية اليمنى عند الجس.'
            },
            choices: ['التهاب حويضة وكلية حاد', 'التهاب مثانة', 'مغص كلوي', 'خراجة حول الكلية'], answer: 'التهاب حويضة وكلية حاد'
        },
        {
            id: 'RES-M-4', level: 'medium', case: 'مريض 60 عاماً، لديه قصة تشمع كبد، أتى بقيء دموي غزير أحمر قانئ، مع هبوط في الضغط وتسارع في النبض.',
            tools: {
                taammul: 'علامات مرض كبدي مزمن (يرقان، عنكبوت وعائي).',
                tahmeel: 'فقر دم حاد وهبوط في الهيموغلوبين.'
            },
            choices: ['نزف دوالي المريء', 'قرحة هضمية نازفة', 'متلازمة مالوري فايس', 'سرطان المعدة النازف'], answer: 'نزف دوالي المريء'
        },
        {
            id: 'RES-M-5', level: 'medium', case: 'مريض يعاني من حمى مرتفعة، سعال منتج لقشع صدئ اللون، وألم جنبي في جهة واحدة.',
            tools: {
                tasammu: 'أصوات تنفسية قصبية وخراخر في قاعدة الرئة اليمنى.',
                qar: 'أصمية عند قرع المنطقة الموافقة في قاعدة الرئة اليمنى.'
            },
            choices: ['ذات رئة فصية (نموذجية)', 'التهاب قصبات حاد', 'انصباب جنب', 'خارجة رئوية'], answer: 'ذات رئة فصية (نموذجية)'
        },
        {
            id: 'RES-M-6', level: 'medium', case: 'شاب من أصل أفريقي، لديه قصة فقر دم مزمن، أتى بألم شديد في العظام والصدر والبطن بعد تعرضه للبرد.',
            tools: {
                tahmeel: 'فقر دم سوي الكريات سوي الصباغ، ولطاخة الدم تظهر كريات دم حمراء بشكل "منجلي".',
                taammul: 'شحوب ويرقان خفيف.'
            },
            choices: ['نوبة مؤلمة في سياق فقر الدم المنجلي', 'احتشاء عظمي', 'متلازمة الصدر الحادة', 'التهاب العظم والنقي'], answer: 'نوبة مؤلمة في سياق فقر الدم المنجلي'
        },
        {
            id: 'RES-M-7', level: 'medium', case: 'مريض 60 عاماً، يعاني من سعال جاف، زلة تنفسية مترقية، وفقدان وزن. الصورة الشعاعية تظهر "عقدة رئوية وحيدة".',
            tools: {
                taammul: 'تعجر الأصابع (Clubbing).',
                tahmeel: 'الكالسيوم في الدم مرتفع (فرط كالسيوم الدم الخلطي).'
            },
            choices: ['سرطان رئة (حرشفي الخلايا)', 'سل', 'ورم حبيبي', 'خراجة رئوية'], answer: 'سرطان رئة (حرشفي الخلايا)'
        },
        {
            id: 'RES-M-8', level: 'medium', case: 'مريض يعاني من إسهال دهني كريه الرائحة، فقدان وزن، وفقر دم. لديه طفح جلدي حاك ومثير للحويصلات على المرفقين والركبتين.',
            tools: {
                taammul: 'الطفح الجلدي هو "التهاب الجلد حلئي الشكل".',
                tahmeel: 'أضداد مضاد ترانس غلوتاميناز النسيجي (Anti-tTG) إيجابية.'
            },
            choices: ['الداء الزلاقي (Celiac Disease)', 'داء كرون', 'قصور بنكرياس خارجي الإفراز', 'متلازمة القولون المتهيج'], answer: 'الداء الزلاقي (Celiac Disease)'
        },
        {
            id: 'RES-M-9', level: 'medium', case: 'مريض 70 عاماً، أتى بحالة من التخليط الذهني الحاد، حمى، وتبول متكرر. لا توجد لديه أعراض عصبية بؤرية.',
            tools: {
                tahmeel: 'تحليل البول يظهر بيلة قيحية ووجود جراثيم.',
                munakkisat: 'الفحص العصبي طبيعي تماماً.'
            },
            choices: ['هذيان تالٍ لعدوى بولية', 'جلطة دماغية', 'التهاب سحايا', 'خرف وعائي'], answer: 'هذيان تالٍ لعدوى بولية'
        },
        {
            id: 'RES-M-10', level: 'medium', case: 'مريض يعاني من ضعف عضلي يزداد سوءاً مع نهاية اليوم، تدلي في الجفن، ورؤية مزدوجة.',
            tools: {
                taammul: 'يزداد تدلي الجفن بعد الطلب من المريض النظر للأعلى لمدة دقيقة.',
                munakkisat: 'المنعكسات طبيعية، ولا يوجد اضطراب حسي.'
            },
            choices: ['وهن عضلي وبيل (Myasthenia Gravis)', 'متلازمة لامبرت-إيتون', 'تصلب لويحي', 'شلل العصب المحرك للعين'], answer: 'وهن عضلي وبيل (Myasthenia Gravis)'
        },
        {
            id: 'RES-M-11', level: 'medium', case: 'مريض يعاني من زيادة في الوزن متركزة في الجذع (سمنة مركزية)، وجه بدري، وحدبة جاموسية، مع ارتفاع في الضغط والسكر.',
            tools: {
                taammul: 'وجود فزر بنفسجية اللون (purple striae) على البطن، مع ترقق في الجلد.',
                tahmeel: 'ارتفاع الكورتيزول في بول 24 ساعة.'
            },
            choices: ['متلازمة كوشينغ', 'قصور درق', 'متلازمة استقلابية', 'تناول ستيروئيدات خارجية'], answer: 'متلازمة كوشينغ'
        },
        {
            id: 'RES-M-12', level: 'medium', case: 'مريض يعاني من حمى، طفح جلدي، ألم مفصلي، وقصة تناول دواء جديد (مضاد حيوي) قبل أسبوع.',
            tools: {
                tahmeel: 'ارتفاع الكريات البيض (خاصة الحمضات)، وارتفاع الكرياتينين.',
                taammul: 'طفح بقعي حطاطي منتشر.'
            },
            choices: ['التهاب كلية خلالي حاد دوائي المنشأ', 'التهاب كبب وكلية', 'ذئبة حمامية جهازية', 'تفاعل دوائي بسيط'], answer: 'التهاب كلية خلالي حاد دوائي المنشأ'
        },
        {
            id: 'RES-M-13', level: 'medium', case: 'مريض 60 عاماً، أتى بألم بطني حاد في الربع السفلي الأيسر، مع حمى وتغير في عادات التغوط.',
            tools: {
                jass: 'إيلام واضح في الحفرة الحرقفية اليسرى مع وجود كتلة مجسوسة.',
                tahmeel: 'ارتفاع في عدد الكريات البيضاء وعلامات الالتهاب (CRP).'
            },
            choices: ['التهاب الرتوج الحاد', 'سرطان قولون', 'فتق مختنق', 'التهاب قولون إقفاري'], answer: 'التهاب الرتوج الحاد'
        },
        {
            id: 'RES-M-14', level: 'medium', case: 'مريض 70 عاماً، يعاني من ألم في ربلة الساق يظهر عند المشي لمسافة معينة ويختفي بالراحة.',
            tools: {
                jass: 'غياب النبض في الشريان الظهري للقدم وشريان قصبة الساق الخلفي.',
                taammul: 'القدم شاحبة وباردة، مع غياب الشعر عليها.'
            },
            choices: ['مرض الشرايين المحيطية (عرج متقطع)', 'تضيق القناة الشوكية (عرج عصبي)', 'خثار وريدي عميق', 'اعتلال أعصاب محيطي'], answer: 'مرض الشرايين المحيطية (عرج متقطع)'
        },
        {
            id: 'RES-M-15', level: 'medium', case: 'مريضة 70 عاماً، لديها قصة قصور قلب، أتت بزلة تنفسية شديدة وسعال رغوي زهري.',
            tools: {
                tasammu: 'خراخر ناعمة منتشرة في الساحتين الرئويتين.',
                taammul: 'وذمات انطباعية في الطرفين السفليين واحتقان في الأوردة الوداجية.'
            },
            choices: ['وذمة رئة حادة قلبية المنشأ', 'نوبة ربو حادة', 'ذات رئة', 'صمة رئوية'], answer: 'وذمة رئة حادة قلبية المنشأ'
        }
    ],
    hard: [
        {
            id: 'RES-H-1', level: 'hard', case: 'مريض 75 عاماً، يشكو من صداع، ألم في الفك عند المضغ (عرج فكي)، واضطراب مفاجئ في الرؤية بعين واحدة.',
            tools: {
                tahmeel: 'ارتفاع شديد في سرعة التثفل (ESR) و CRP.',
                jass: 'إيلام عند جس الشريان الصدغي السطحي مع غياب نبضه.',
                taammul: 'فحص قعر العين يظهر شحوباً في القرص البصري (اعتلال عصب بصري إقفاري).'
            },
            choices: ['التهاب الشريان ذو الخلايا العرطلة', 'ألم عصب مثلث التوائم', 'صداع عنقودي', 'زرق حاد مغلق الزاوية'], answer: 'التهاب الشريان ذو الخلايا العرطلة'
        },
        {
            id: 'RES-H-2', level: 'hard', case: 'مريض يعاني من حمى، انخفاض ضغط، طفح جلدي أحمر منتشر يشبه حروق الشمس، وتقشر في جلد اليدين والقدمين.',
            tools: {
                taammul: 'احتقان شديد في الملتحمة ومخاطية الفم (لسان الفراولة).',
                tahmeel: 'ارتفاع الكرياتينين، اضطراب في وظائف الكبد، ونقص في الصفيحات.',
                jass: 'لا يوجد بؤرة إنتانية واضحة، لكن المريض استخدم سدادات قطنية أنفية لوقف الرعاف.'
            },
            choices: ['متلازمة الصدمة السمية (TSS)', 'مرض كاواساكي', 'الحمى القرمزية', 'تفاعل دوائي شديد (SJS/TEN)'], answer: 'متلازمة الصدمة السمية (TSS)'
        },
        {
            id: 'RES-H-3', level: 'hard', case: 'مريض لديه قصة سرطان، أتى بزلة تنفسية مترقية، تورم في الوجه والذراعين، واحتقان في أوردة العنق والصدر.',
            tools: {
                taammul: 'وذمة في الوجه والعنق والطرفين العلويين، مع بروز الأوردة الصدرية.',
                jass: 'علامة بيمبرتون إيجابية (احتقان وجهي عند رفع الذراعين فوق الرأس).',
                tasammu: 'أصوات القلب والتنفس طبيعية.'
            },
            choices: ['متلازمة الوريد الأجوف العلوي (SVCS)', 'قصور قلب أيمن حاد', 'صمة رئوية', 'التهاب التامور العاصر'], answer: 'متلازمة الوريد الأجوف العلوي (SVCS)'
        },
        {
            id: 'RES-H-4', level: 'hard', case: 'مريض يعاني من ضعف، فقدان وزن، تصبغات جلدية برونزية اللون (خاصة في أماكن الاحتكاك وندبات الجراحة)، مع انخفاض في الضغط الشرياني.',
            tools: {
                tahmeel: 'نقص صوديوم، ارتفاع بوتاسيوم، ونقص سكر في الدم.',
                taammul: 'تصبغات في مخاطية باطن الخد.',
                jass: 'هبوط ضغط انتصابي واضح.'
            },
            choices: ['داء أديسون (قصور كظر أولي)', 'قصور نخامة شامل', 'متلازمة نلسون', 'داء ترسب الأصبغة الدموية'], answer: 'داء أديسون (قصور كظر أولي)'
        },
        {
            id: 'RES-H-5', level: 'hard', case: 'مريض أتى بحمى، ألم مفصلي، وبقع نزفية صغيرة تحت الأظافر (splinter hemorrhages). لديه قصة تركيب صمام قلبي اصطناعي.',
            tools: {
                tasammu: 'سماع نفخة قلبية جديدة أو تغير في طبيعة النفخة القديمة.',
                taammul: 'وجود عقد أوسلر (مؤلمة) على رؤوس الأصابع وبقع جينواي (غير مؤلمة) على الراحتين.',
                tahmeel: 'زرع الدم إيجابي لنمو جراثيم (مثل العقديات المخضرة).'
            },
            choices: ['التهاب شغاف القلب العدوائي', 'حمى رثوية حادة', 'ذئبة حمامية جهازية', 'التهاب أوعية دموية'], answer: 'التهاب شغاف القلب العدوائي'
        },
        {
            id: 'RES-H-6', level: 'hard', case: 'مريض يعاني من نوب متكررة من الإسهال المائي، تورد واحمرار في الوجه والعنق، وتشنج قصبي (وزيز).',
            tools: {
                tasammu: 'وزيز أثناء النوبة، ونفخة قلبية تدل على إصابة الصمام ثلاثي الشرف.',
                tahmeel: 'ارتفاع مستوى 5-HIAA (مستقلب السيروتونين) في بول 24 ساعة.',
                jass: 'تضخم في الكبد.'
            },
            choices: ['المتلازمة السرطاوية (Carcinoid Syndrome)', 'ورم القواتم', 'حساسية طعام شديدة', 'Mastocytosis'], answer: 'المتلازمة السرطاوية (Carcinoid Syndrome)'
        },
        {
            id: 'RES-H-7', level: 'hard', case: 'مريض يعاني من ألم عظمي، قصور كلوي، فقر دم، وارتفاع في كالسيوم الدم. لديه قصة التهابات متكررة.',
            tools: {
                tahmeel: 'وجود بروتين وحيد النسيلة (M-protein) في مصل الدم والبول، مع فجوة أنيونية منخفضة.',
                munakkisat: 'قد تظهر أعراض انضغاط الحبل الشوكي إذا وجدت آفة ناخرة في الفقرات.',
                jass: 'إيلام عند جس مناطق معينة من العظام (مثل الأضلاع والعمود الفقري).'
            },
            choices: ['الورم النقوي المتعدد (Multiple Myeloma)', 'نقائل سرطانية للعظم', 'فرط نشاط جارات الدرق الأولي', 'ساركويد'], answer: 'الورم النقوي المتعدد (Multiple Myeloma)'
        },
        {
            id: 'RES-H-8', level: 'hard', case: 'مريض أتى بحمى، صداع، وتخليط ذهني، يليه ظهور طفح نزفي (فرفريات) ينتشر بسرعة كبيرة مع هبوط حاد في الضغط.',
            tools: {
                taammul: 'فرفريات خاطفة (purpura fulminans) مع بداية تنخر في مركزها.',
                tahmeel: 'علامات تخثر منتشر داخل الأوعية (DIC): نقص صفيحات، ارتفاع D-dimer، تطاول زمن التخثر.',
                munakkisat: 'علامات تهيج سحايا إيجابية.'
            },
            choices: ['إنتان سحائيات الدم (Meningococcemia)', 'متلازمة الصدمة السمية', 'حمى الجبال الصخرية المبقعة', 'تجرثم دم بالبكتيريا العنقودية'], answer: 'إنتان سحائيات الدم (Meningococcemia)'
        },
        {
            id: 'RES-H-9', level: 'hard', case: 'مريض يعاني من عطش شديد وتبول كميات هائلة من البول المخفف جداً (تصل إلى 10 لترات في اليوم). لديه قصة رض على الرأس مؤخراً.',
            tools: {
                tahmeel: 'ارتفاع أوسمولالية المصل وارتفاع صوديوم المصل، مع انخفاض أوسمولالية البول بشكل غير متناسب.',
                taammul: 'علامات جفاف شديد إذا لم يتم تعويض السوائل.',
                munakkisat: 'الفحص العصبي قد يكون طبيعياً أو يظهر علامات مرتبطة بالرض الأصلي.'
            },
            choices: ['البوالة التفهة مركزية المنشأ (Central Diabetes Insipidus)', 'البوالة التفهة كلوية المنشأ', 'العطاش نفسي المنشأ', 'سكري غير مضبوط'], answer: 'البوالة التفهة مركزية المنشأ (Central Diabetes Insipidus)'
        },
        {
            id: 'RES-H-10', level: 'hard', case: 'مريض يعاني من ألم بطني، اعتلال أعصاب محيطي (تدلي القدم)، وفقر دم انحلالي. الفحص يظهر خطاً أزرق على حافة اللثة.',            tools: {
                taammul: 'وجود "خط بورتون" (Burton\'s line) على اللثة.',
                tahmeel: 'فقر دم مع وجود "تنقط أساسي" (basophilic stippling) في الكريات الحمر.',
                munakkisat: 'ضعف في العضلات الباسطة للرسغ والقدم (wrist/foot drop).'
            },
            choices: ['التسمم بالرصاص', 'البورفيريا المتقطعة الحادة', 'متلازمة غيلان باريه', 'التسمم بالزرنيخ'], answer: 'التسمم بالرصاص'
        }
    ]
}
};
// =================================================================================
//                                 القسم الأول: كل المتغيرات
// =================================================================================
// =================================================================================
//                                 القسم الأول: كل المتغيرات
// =================================================================================

// ⚠️ تذكير: يجب لصق متغيرات `trainingBank` و `challengeBank` الجديدة هنا

// =================================================================================
//                                 القسم الأول: كل المتغيرات
// =================================================================================

// ⚠️ تذكير: يجب لصق متغيرات `trainingBank` و `challengeBank` الجديدة هنا
// =================================================================================
//                                 القسم الأول: كل المتغيرات
// =================================================================================

// =================================================================================
//                                 القسم الأول: كل المتغيرات
// =================================================================================

// ⚠️ تذكير: يجب لصق متغيرات `trainingBank` و `challengeBank` الجديدة هنا
// الصق المتغيرات هنا...
// =================================================================================
//                                 القسم الأول: كل المتغيرات
// =================================================================================
// =================================================================================
//                                 القسم الأول: كل المتغيرات
// =================================================================================

// ⚠️ تذكير: يجب لصق متغيرات `trainingBank` و `challengeBank` التي نسختها هنا
// =================================================================================
// ⚠️ تذكير: يجب لصق متغيرات `trainingBank` و `challengeBank` التي نسختها هنا
// =================================================================================


// انتظر حتى يتم تحميل كل محتوى الصفحة تمامًا
document.addEventListener('DOMContentLoaded', () => {

    // --- سنقوم بتعريف كل المتغيرات هنا، داخل المستمع ---
    // هذا يضمن 100% أن العناصر موجودة
    
    // 2. عناصر الواجهة
    const screens = {
        start: document.getElementById('start-screen'),
        modeSelection: document.getElementById('mode-selection-screen'),
        specialtySelection: document.getElementById('specialty-selection-screen'),
        game: document.getElementById('game-screen'),
        lose: document.getElementById('lose-screen'),
        win: document.getElementById('win-screen'),
        stats: document.getElementById('stats-screen'),
    };
    const buttons = {
        startGame: document.getElementById('start-game-btn'),
        trainingMode: document.getElementById('training-mode-btn'),
        grandRound: document.getElementById('grand-round-btn'),
        skipQuestion: document.getElementById('skip-question-btn'),
        restartGrandRound: document.getElementById('restart-grand-round-btn'),
        backToMainMenuLose: document.getElementById('back-to-main-menu-lose'),
        backToMainMenuWin: document.getElementById('back-to-main-menu-win'),
        showStats: document.getElementById('stats-btn-main'), // التصحيح الأصلي
        backToMainMenuStats: document.getElementById('back-to-main-menu-stats'),
    };
    const gameElements = {
        budgetDisplay: document.getElementById('budget-display'),
        questionCounter: document.getElementById('question-counter'),
        timerDisplay: document.getElementById('timer-display'),
        caseTitle: document.getElementById('case-title'),
        caseDescription: document.getElementById('case-description'),
        patientFileContent: document.getElementById('file-content'),
        choicesContainer: document.getElementById('choices-container'),
    };
    const statsElements = {
        bestPercentage: document.getElementById('best-percentage'),
        totalAttempts: document.getElementById('total-attempts-stats'),
        highestStage: document.getElementById('highest-stage'),
        recentHistory: document.getElementById('recent-history-list'),
    };
    const modal = {
        element: document.getElementById('modal'),
        title: document.getElementById('modal-title'),
        text: document.getElementById('modal-text'),
        closeBtn: document.querySelector('.close-btn'),
        confirmBtn: document.getElementById('modal-confirm-btn'),
        cancelBtn: document.getElementById('modal-cancel-btn'),
    };

    // 3. متغيرات حالة اللعبة
    let gameState = {};
    let personalStats = JSON.parse(localStorage.getItem('personalStats')) || {
        bestPercentage: 0,
        totalAttempts: 0,
        highestStage: '0 / 15',
        recentHistory: [],
        isFirstAttempt: true,
    };
    let timerInterval;
    let currentScreenName = 'start';

    // --- كل الدوال يجب أن تكون هنا أيضاً أو يمكن الوصول إليها ---
    // (للبساطة، سنتركها في النطاق العام كما كانت، لكن التعريفات أعلاه الآن مضمونة)

    // --- وظائف التحكم بالواجهة (مع دعم زر الرجوع) ---
    function showScreen(screenName, isPoppingState = false) {
        Object.values(screens).forEach(screen => screen.classList.remove('active'));
        screens[screenName].classList.add('active');
        currentScreenName = screenName;

        if (!isPoppingState) {
            if (history.state?.screen !== screenName) {
                history.pushState({ screen: screenName }, `Screen ${screenName}`, `#${screenName}`);
            }
        }
    }

    window.onpopstate = function(event) {
        if (currentScreenName === 'game') {
            history.forward();
            showModal(
                'تأكيد الخروج',
                'هل أنت متأكد من رغبتك في مغادرة اللعبة؟ سيتم فقدان تقدمك الحالي.',
                true,
                () => {
                    clearInterval(timerInterval);
                    showScreen('modeSelection');
                }
            );
        } else if (event.state && event.state.screen) {
            showScreen(event.state.screen, true);
        } else {
            showScreen('start', true);
        }
    };

    function showModal(title, text, showConfirmButtons = false, onConfirm = null) {
        modal.title.innerHTML = title;
        modal.text.innerHTML = text;
        modal.element.style.display = 'flex';

        modal.cancelBtn.onclick = () => modal.element.style.display = 'none';

        if (showConfirmButtons) {
            modal.confirmBtn.style.display = 'inline-block';
            modal.cancelBtn.style.display = 'inline-block';
            modal.confirmBtn.onclick = () => {
                modal.element.style.display = 'none';
                if (onConfirm) onConfirm();
            };
        } else {
            modal.confirmBtn.style.display = 'none';
            modal.cancelBtn.style.display = 'none';
        }
    }

    // --- وظائف الإعداد والتحكم ---
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function saveStats() {
        localStorage.setItem('personalStats', JSON.stringify(personalStats));
    }

    function displayStats() {
        statsElements.bestPercentage.textContent = `${personalStats.bestPercentage}%`;
        statsElements.totalAttempts.textContent = personalStats.totalAttempts;
        statsElements.highestStage.textContent = personalStats.highestStage;
        statsElements.recentHistory.innerHTML = '';
        if (personalStats.recentHistory.length === 0) {
            statsElements.recentHistory.innerHTML = '<li>لا يوجد سجل محاولات بعد.</li>';
        } else {
            [...personalStats.recentHistory].reverse().forEach(attempt => {
                const li = document.createElement('li');
                li.innerHTML = `<span>النتيجة: <b>${attempt.percentage}%</b></span> <span>المرحلة: ${attempt.stage}</span>`;
                statsElements.recentHistory.appendChild(li);
            });
        }
        showScreen('stats');
    }

    function startTrainingMode(specialty) {
        gameState = {
            mode: 'training',
            specialty: specialty,
            questions: [...trainingBank[specialty]],
            currentQuestionIndex: 0,
            budget: 150,
        };
        setupQuestion();
        showScreen('game');
        clearInterval(timerInterval);
        gameElements.timerDisplay.textContent = '∞';
    }

    function startGrandRound() {
        if (personalStats.isFirstAttempt) {
            personalStats.isFirstAttempt = false;
        }
        personalStats.totalAttempts++;
        saveStats();

        let questions;
        if (personalStats.totalAttempts === 1) {
            questions = [
                ...challengeBank.core.easy,
                ...challengeBank.core.medium,
                ...challengeBank.core.hard
            ];
        } else {
            const easyQuestions = shuffleArray([...challengeBank.reserve.easy]).slice(0, 5);
            const mediumQuestions = shuffleArray([...challengeBank.reserve.medium]).slice(0, 5);
            const hardQuestions = shuffleArray([...challengeBank.reserve.hard]).slice(0, 5);
            questions = shuffleArray([...easyQuestions, ...mediumQuestions, ...hardQuestions]);
        }

        gameState = {
            mode: 'grand_round',
            questions: questions,
            currentQuestionIndex: 0,
            budget: 200,
        };
        startTimer(15 * 60, gameElements.timerDisplay);
        setupQuestion();
        showScreen('game');
    }

    function setupSpecialtySelection() {
        const grid = document.getElementById('specialty-grid');
        grid.innerHTML = '';
        Object.keys(trainingBank).forEach(specialty => {
            const button = document.createElement('button');
            button.className = 'specialty-btn';
            button.textContent = specialty;
            button.onclick = () => startTrainingMode(specialty);
            grid.appendChild(button);
        });
        showScreen('specialtySelection');
    }

    function startTimer(duration, display) {
        let timer = duration, minutes, seconds;
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            minutes = parseInt(timer / 60, 10);
            seconds = parseInt(timer % 60, 10);
            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;
            display.textContent = minutes + ":" + seconds;
            if (--timer < 0) {
                clearInterval(timerInterval);
                loseGame();
            }
        }, 1000);
    }

    // --- وظائف منطق اللعبة الفعلي ---
    function setupQuestion() {
        gameElements.patientFileContent.innerHTML = '<p class="placeholder">استخدم الأدوات لكشف المعلومات وإضافتها إلى الملف...</p>';
        document.querySelectorAll('.tool-item').forEach(t => {
            t.classList.remove('used');
            t.style.display = '';
        });
        
        const question = gameState.questions[gameState.currentQuestionIndex];
        
        gameElements.budgetDisplay.textContent = gameState.budget;
        gameElements.questionCounter.textContent = `${gameState.currentQuestionIndex + 1} / ${gameState.questions.length}`;
        gameElements.caseTitle.textContent = `الحالة رقم #${gameState.currentQuestionIndex + 1} (صعوبة: ${question.level})`;
        gameElements.caseDescription.textContent = question.case;

        gameElements.choicesContainer.innerHTML = '';
        const shuffledChoices = shuffleArray([...question.choices]);
        shuffledChoices.forEach(choice => {
            const button = document.createElement('button');
            button.className = 'choice-btn';
            button.textContent = choice;
            button.onclick = () => checkAnswer(choice);
            gameElements.choicesContainer.appendChild(button);
        });
    }

    function useTool(toolElement) {
        if (toolElement.classList.contains('used')) return;
        const toolName = toolElement.dataset.tool;
        const costElement = toolElement.querySelector('.tool-cost');
        if (!costElement) return;
        const cost = parseInt(costElement.textContent);
        if (gameState.budget < cost) {
            showModal('ميزانية غير كافية!', 'لا يمكنك استخدام هذه الأداة.');
            return;
        }
        updateBudget(-cost);
        toolElement.classList.add('used');
        const question = gameState.questions[gameState.currentQuestionIndex];
        const info = question.tools[toolName];
        if (info) {
            addInfoToPatientFile(info, toolElement.querySelector('.tool-name').textContent);
        } else {
            addInfoToPatientFile('لا توجد معلومات مفيدة من هذه الأداة لهذه الحالة.', toolElement.querySelector('.tool-name').textContent);
        }
    }

    function useAssistTool(toolElement) {
        if (toolElement.classList.contains('used')) return;
        const toolName = toolElement.dataset.tool;
        const cost = parseInt(toolElement.querySelector('.tool-cost').textContent);
        if (gameState.budget < cost) {
            showModal('ميزانية غير كافية!', 'لا يمكنك استخدام هذه الأداة.');
            return;
        }
        updateBudget(-cost);
        toolElement.classList.add('used');
        const question = gameState.questions[gameState.currentQuestionIndex];
        if (toolName === 'consultation') {
            let wrongChoices = question.choices.filter(c => c !== question.answer);
            wrongChoices = shuffleArray(wrongChoices).slice(0, 2);
            document.querySelectorAll('.choice-btn').forEach(btn => {
                if (wrongChoices.includes(btn.textContent)) {
                    btn.style.display = 'none';
                }
            });
            showModal('💡 مساعدة (50/50)', `لقد قمت باستشارة زميل، وقام باستبعاد إجابتين خاطئتين من أجلك.`);
        }
    }

    function skipQuestion() {
        const penalty = 30;
        if (gameState.budget < penalty) {
            showModal('لا يمكن التخطي!', `أنت بحاجة إلى ${penalty} نقطة على الأقل لتخطي السؤال.`);
            return;
        }
        showModal(
            'تأكيد التخطي',
            `هل أنت متأكد من رغبتك في تخطي هذا السؤال؟ سيتم خصم <b>${penalty} نقطة</b> من ميزانيتك.`,
            true,
            () => {
                updateBudget(-penalty);
                showModal('تم التخطي!', 'لقد تخطيت السؤال الحالي.');
                setTimeout(nextQuestion, 1500);
            }
        );
    }

    function addInfoToPatientFile(info, toolName) {
        if (gameElements.patientFileContent.querySelector('.placeholder')) {
            gameElements.patientFileContent.innerHTML = '';
        }
        const infoCard = document.createElement('div');
        infoCard.className = 'info-card';
        infoCard.innerHTML = `<strong>${toolName}:</strong> ${info}`;
        gameElements.patientFileContent.appendChild(infoCard);
    }

    function updateBudget(amount) {
        gameState.budget += amount;
        gameElements.budgetDisplay.textContent = gameState.budget;
    }

    function checkAnswer(selectedAnswer) {
        const question = gameState.questions[gameState.currentQuestionIndex];
        if (selectedAnswer === question.answer) {
            const reward = 15;
            updateBudget(reward);
            showModal('إجابة صحيحة!', `تشخيصك صحيح! لقد ربحت ${reward} نقطة.`);
            setTimeout(nextQuestion, 1500);
        } else {
            if (gameState.mode === 'grand_round') {
                loseGame();
            } else {
                const penalty = 25;
                updateBudget(-penalty);
                showModal('إجابة خاطئة!', `التشخيص الصحيح كان: <b>${question.answer}</b>. تم خصم ${penalty} نقطة.`);
                setTimeout(nextQuestion, 3000);
            }
        }
    }

    function nextQuestion() {
        gameState.currentQuestionIndex++;
        if (gameState.currentQuestionIndex >= gameState.questions.length) {
            if (gameState.mode === 'grand_round') {
                winGame();
            } else {
                showModal('التدريب انتهى!', `لقد أكملت مناوبة <b>${gameState.specialty}</b> بنجاح. نتيجتك التدريبية هي ${gameState.budget} نقطة.`);
                setTimeout(() => showScreen('modeSelection'), 2000);
            }
        } else {
            setupQuestion();
        }
    }

    function loseGame() {
        clearInterval(timerInterval);
        updateStatsOnFinish(false);
        document.getElementById('lose-reason').innerHTML = "لقد خسرت وخسر المريض حياته. شكراً لجهودك المبذولة &#128513;<br>حاول مرة أخرى أو ارجع إلى القائمة الرئيسية.";
        showScreen('lose');
    }

    function winGame() {
        clearInterval(timerInterval);
        updateStatsOnFinish(true);
        showScreen('win');
    }

    function updateStatsOnFinish(isWin) {
        if (gameState.mode !== 'grand_round') return;
        const finalScore = gameState.budget;
        const stageReached = isWin ? gameState.questions.length : gameState.currentQuestionIndex;
        const totalStages = gameState.questions.length;
        let efficiency = ((finalScore / 200) * 60) + ((stageReached / totalStages) * 40);
        efficiency = Math.max(0, Math.min(100, efficiency)).toFixed(0);
        if (efficiency > personalStats.bestPercentage) {
            personalStats.bestPercentage = efficiency;
        }
        const currentHighestStage = parseInt(personalStats.highestStage.split(' ')[0]);
        if (stageReached > currentHighestStage) {
            personalStats.highestStage = `${stageReached} / ${totalStages}`;
        }
        personalStats.recentHistory.push({
            percentage: efficiency,
            stage: `${stageReached} / ${totalStages}`
        });
        if (personalStats.recentHistory.length > 5) {
            personalStats.recentHistory.shift();
        }
        saveStats();
        if (isWin) {
            document.getElementById('final-score').textContent = finalScore;
            document.getElementById('final-percentage-display').textContent = `${efficiency}%`;
        }
    }

    // --- نقطة الانطلاق ---
    function setupEventListeners() {
        // التحقق من وجود كل زر قبل ربط الحدث
        if (!buttons.showStats) {
            alert("فشل العثور على زر الإحصائيات 'stats-btn-main'.");
            return; // أوقف التنفيذ إذا كان الزر الرئيسي مفقودًا
        }

        buttons.startGame.onclick = () => showScreen('modeSelection');
        buttons.trainingMode.onclick = setupSpecialtySelection;
        buttons.grandRound.onclick = () => {
            showModal(
                '<h3>🏆 قواعد الجولة الكبرى: دليل المشخص المحترف</h3>',
                `<p>مرحباً بك في التحدي الأسمى! هنا، لا مجال للخطأ. هدفك هو إثبات أنك تملك المعرفة والحدس السريري لتجاوز 15 حالة متتالية.</p>
                <ul>
                    <li><b>🧠 الهدف الأساسي:</b> حل 15 حالة سريرية يتم اختيارها عشوائياً، وتتدرج في الصعوبة.</li>
                    <li><b>💰 الميزانية الأولية:</b> تبدأ رحلتك بـ <b>200 نقطة</b>. إدارتها بحكمة هي مفتاح النجاح.</li>
                    <li><b>⏳ عداد الوقت:</b> لديك <b>15 دقيقة فقط</b> لإكمال الجولة. إذا انتهى الوقت، تنتهي الجولة.</li>
                    <li><b>❌ سياسة الخطأ الواحد:</b> هذه هي القاعدة الأهم: <b>أي إجابة خاطئة تنهي الجولة فوراً!</b></li>
                </ul>
                <p><b>هل أنت مستعد لإثبات جدارتك؟</b></p>`,
                true,
                startGrandRound
            );
        };
        buttons.skipQuestion.onclick = skipQuestion;
        buttons.restartGrandRound.onclick = () => showScreen('modeSelection');
        buttons.backToMainMenuLose.onclick = () => showScreen('modeSelection');
        buttons.backToMainMenuWin.onclick = () => showScreen('modeSelection');
        
        buttons.showStats.onclick = displayStats; // الربط المباشر والصحيح
        buttons.backToMainMenuStats.onclick = () => showScreen('modeSelection');

        document.querySelectorAll('.tool-item:not(.skip-btn)').forEach(tool => {
            if (tool.dataset.tool === 'consultation') {
                tool.onclick = () => useAssistTool(tool);
            } else {
                tool.onclick = () => useTool(tool);
            }
        });
        
        modal.closeBtn.onclick = () => modal.element.style.display = 'none';
        window.onclick = (event) => {
            if (event.target == modal.element) {
                modal.element.style.display = 'none';
            }
        };
    }

    // --- بدء تشغيل التطبيق ---
    const initialScreen = location.hash ? location.hash.substring(1) : 'start';
    if (screens[initialScreen]) {
        showScreen(initialScreen, true);
    } else {
        showScreen('start', true);
    }
    setupEventListeners();

}); // نهاية مستمع `DOMContentLoaded`
        


